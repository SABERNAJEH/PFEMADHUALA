name: üõ°Ô∏è Kubernetes Security Pipeline

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  notifications:
    uses: ./.github/workflows/notification-job.yml
    secrets:
      EMAIL_TO: "saber.fraj@etudiant-isi.utm.tn,najeh.wchem@etudiant-isi.utm.tn"
      EMAIL_FROM: ${{ secrets.GMAIL_USERNAME }}
      EMAIL_PWD: ${{ secrets.GMAIL_PASSWORD }}

  security-scan:
    needs: notifications
    uses: ./.github/workflows/scanning-job.yml
    secrets:
      EMAIL_FROM: ${{ secrets.GMAIL_USERNAME }}
      EMAIL_PWD: ${{ secrets.GMAIL_PASSWORD }}
      REPORT_TO: ${{ secrets.REPORT_EMAIL }}

  validation:
    needs: security-scan
    uses: ./.github/workflows/validation-job.yml
    with:
      scan-results: ${{ needs.security-scan.outputs.scan-results }}
