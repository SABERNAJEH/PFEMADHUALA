name: üõ°Ô∏è Kubernetes Security Pipeline

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  notifications:
    uses: ./.github/workflows/notification-job.yml
    secrets:
      EMAIL_TO: "saber.fraj@etudiant-isi.utm.tn,najeh.wchem@etudiant-isi.utm.tn"
      GMAIL_USER: ${{ secrets.GMAIL_USERNAME }}  # Corrig√© pour correspondre √† votre secret existant
      GMAIL_PASSWORD: ${{ secrets.GMAIL_PASSWORD }}

  security-scan:
    needs: notifications
    uses: ./.github/workflows/scanning-job.yml
    secrets:
      GMAIL_USER: ${{ secrets.GMAIL_USERNAME }}  # Utilisation des secrets existants
      GMAIL_PASSWORD: ${{ secrets.GMAIL_PASSWORD }}
      REPORT_EMAIL: ${{ secrets.REPORT_EMAIL }}  # Apr√®s l'avoir cr√©√©

  validation:
    needs: security-scan
    uses: ./.github/workflows/validation-job.yml
    with:
      scan-results: ${{ needs.security-scan.outputs.scan-results }}
